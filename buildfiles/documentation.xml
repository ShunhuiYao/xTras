	<target name="documentation">
		&defmma;
		<antcall target="docbuild" />
		<antcall target="replaceStuff" />
		<antcall target="indexbuild" />
	</target>


	<target name="clean">
		<delete  dir="${dist}" />
	</target>
	
	<target name="docbuild" depends="clean">

		<property name="mathematicaInstallDir" value="${docMathematicaInstallDir}"/>
		<property name="mathExe" value="${docMathExe}"/>

		<echo>## BUILDING DOCUMENTATION ##</echo>
		<echo message="MathKernel: ${mathExe}"/>
		<echo message="Mathematica Install Dir: ${mathematicaInstallDir}"/>
	  	
		<ant antfile="${appPath}/DocumentationBuild/SystemFiles/ant/Build/notebook.xml"
	           target="main">
	    	<property name="outputDir" value="${outputDirNB}" />
	        <property name="language" value="English" />
	    </ant>

		<antcall target="createHTML" />	
		<antcall target="setupPaclet" />

	</target>

	<target name="createHTML" if="Mathematica.DocumentationBuild.createHTML">
	    <ant antfile="${appPath}/DocumentationBuild/SystemFiles/ant/Build/html.xml"
	           target="main">
				<property name="local" value="True"/>
				<property name="completeHTMLQ" value="True"/>
				<property name="includeLinkTrails" value="False"/>	
	           	<property name="outputDir" value="${outputDirWeb}" />
	        <property name="language" value="English" />
	    </ant>	
	</target>
	
	<target name="setupPaclet" if="buildNBDocs">	
		<copy file="${basedir}/PacletInfo.m" todir="${dist}/${pacletContainer}" overwrite="true" />
		<copy todir="${dist}/${pacletContainer}/${docOutputDir}" overwrite="true" >
		<fileset dir="${basedir}/${docInputDir}">
		    <exclude name="*/Guides/**"/>
		    <exclude name="*/ReferencePages/**"/>
	    	<exclude name="*/Tutorials/**"/>
		</fileset>
		</copy>
	</target>
	
	<target name="indexbuild">
		<mathematica exe="${indexBuildMathExe}" fresh="true" failonerror="false">
			<![CDATA[
			
			AntLog[$Version];
			
			Get[FileNameJoin[{AntProperty["basedir"],"buildfiles","indexbuild.m"}]];
	
			]]>
		</mathematica>
	</target>

	<target name="replaceStuff">
	
		<echo>## REPLACING STRINGS IN DOCS ##</echo>
		
		<!-- x Tras to xTras -->
		<!-- Guides -->
		<replace dir="${dist}" value='"XTRAS GUIDE"'>
		  <include name="**/*.nb"/>
		  <replacetoken>"X TRAS GUIDE"</replacetoken>
		</replace>
		<replace dir="${dist}" value='"xTras Guide"'>
		  <include name="**/*.nb"/>
		  <replacetoken>"x Tras Guide"</replacetoken>
		</replace>
		<!-- Symbols -->
		<replace dir="${dist}" value='"XTRAS PACKAGE SYMBOL"'>
		  <include name="**/*.nb"/>
		  <replacetoken>"X TRAS PACKAGE SYMBOL"</replacetoken>
		</replace>
		<replace dir="${dist}" value='"xTras Package Symbol"'>
		  <include name="**/*.nb"/>
		  <replacetoken>"x Tras Package Symbol"</replacetoken>
		</replace>
		<replace dir="${dist}" value='"XTRAS SYMBOL"'>
		  <include name="**/*.nb"/>
		  <replacetoken>"X TRAS SYMBOL"</replacetoken>
		</replace>
		<replace dir="${dist}" value='"xTras Symbol"'>
		  <include name="**/*.nb"/>
		  <replacetoken>"x Tras Symbol"</replacetoken>
			</replace>
		<!-- Tutorials -->
		<replace dir="${dist}" value='"XTRAS TUTORIAL"'>
		  <include name="**/*.nb"/>
		  <replacetoken>"X TRAS TUTORIAL"</replacetoken>
		</replace>
		<replace dir="${dist}" value='"xTras Tutorial"'>
		  <include name="**/*.nb"/>
		  <replacetoken>"x Tras Tutorial"</replacetoken>
		</replace>
		
		<!-- Remove CacheIDs -->
		<replace dir="${dist}" value=''>
		  <include name="**/*.nb"/>
		  <replacetoken>(*CacheID: 234*)</replacetoken>
		</replace>

		<!-- Change FrontEndVersion to 6.0 -->
		<replaceregexp match='FrontEndVersion -> "(.*)"' replace='FrontEndVersion -> "6.0"' byline="true">
		    <fileset dir="${dist}" includes="**/*.nb"/>
		</replaceregexp>
		<replaceregexp match='FrontEndVersion->"(.*)"' replace='FrontEndVersion->"6.0"' byline="true">
		    <fileset dir="${dist}" includes="**/*.nb"/>
		</replaceregexp>
			
		<!-- Remove box around MORE INFORMATION -->
		<!--
		<replace dir="${dist}" value='StyleBox[RowBox[{"MORE", " ", "INFORMATION"}], "NotesFrameText"]'>
		  <include name="**/*.nb"/>
		  <replacetoken><![CDATA[FrameBox[
   StyleBox[
    RowBox[{"MORE", " ", "INFORMATION"}], "NotesFrameText"],
   StripOnInput->False]]]></replacetoken>
		</replace>
		-->
		
	</target>

